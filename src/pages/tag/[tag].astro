---
import Layout from "../../layouts/Layout.astro";
import Main from '../../components/Main.astro';
import PostList from '../../components/PostList.astro';
import { getCollection, type CollectionEntry } from "astro:content";

export const getStaticPaths = async () => {
  const posts = await getCollection("posts");
  const uniqueTags = new Set(posts.flatMap(post => post.data.tags))

  // Generamos las rutas de los tags con params los distintos tags disponibles
  // y props todos aquellos posts referentes al tag
  const paths = Array.from(uniqueTags).map((tag) => ({
      params: { tag },
      props: { posts: posts.filter(post => post.data.tags.includes(tag)), tag: tag },
  }));

  return paths;
};

type Props = {
  posts: CollectionEntry<"posts">;
  tag: string;
};

const { posts, tag } = Astro.props;
---

<Layout title={`AIdventure - ${tag}`}>
    <Main>
        <div class="max-w-2xl mx-auto text-center mb-12">
			<h2 class="text-3xl lg:text-5xl font-display text-black">
			Tagged
			</h2>
			<p class="xl:text-xl tracking-tight text-black mt-3">
				All posts tagged with <b>#{tag}</b>
			</p>
		</div>
        <PostList posts={posts} />
    </Main>
</Layout>

