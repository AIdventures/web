---
import { Image } from 'astro:assets';
import TableOfContents from '../components/TableOfContents.astro';
import Footer from '../components/Footer.astro';
import CodeCopyButton from '../components/CodeCopyButton.astro';
import TableWrapper from '../components/TableWrapper.astro';
import Search from '../components/Search';
import '../styles/global.css';

import type { ImageMetadata } from 'astro';

interface Props {
  frontmatter: {
    title: string;
    description?: string;
    pubDate: Date;
    image?: ImageMetadata;
    tags?: string[];
  };
  headings: Array<{ depth: number; slug: string; text: string }>;
}

const { frontmatter, headings } = Astro.props as Props;
const description = frontmatter.description || "Exploring AI and machine learning â€” one paper, tool, and technique at a time.";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>AIdventure - {frontmatter.title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article" />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:title" content={`AIdventure - ${frontmatter.title}`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="https://aidventure.es/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={Astro.url.href} />
    <meta name="twitter:title" content={`AIdventure - ${frontmatter.title}`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://aidventure.es/og-image.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  </head>
  <body class="bg-bg text-primary min-h-screen p-6 md:p-12 max-w-7xl mx-auto flex flex-col">
    
    <header class="mb-12 flex justify-between items-center font-sans">
      <a href="/" class="font-bold text-xl tracking-tight hover:opacity-70 transition">AIdventure</a>
      <Search client:load />
    </header>

    <main class="flex-grow grid grid-cols-1 lg:grid-cols-[1fr_250px] gap-12">
      
      <article class="prose prose-stone prose-lg max-w-none min-w-0">
        <header class="mb-8 not-prose">
            <h1 class="text-4xl md:text-5xl font-serif font-medium mb-4">{frontmatter.title}</h1>
            <p class="text-stone-500 font-sans text-sm">{frontmatter.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
            
            {frontmatter.tags && frontmatter.tags.length > 0 && (
              <div class="mt-4 flex flex-row items-baseline gap-2">
                <p class="text-stone-500 font-sans text-xs">Tags:</p>
                <div class="flex flex-wrap gap-2">
                    {frontmatter.tags.map((tag) => (
                        <a href={`/tags/${tag}`} class="text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded-full hover:bg-stone-200 transition-colors no-underline">
                            #{tag}
                        </a>
                    ))}
                </div>
              </div>
            )}

            {/* Mobile ToC appears here naturally via flow, Desktop via grid */}
            <div class="lg:hidden mt-8">
               <TableOfContents headings={headings} />
            </div>
        </header>

        {frontmatter.image && (
            <Image src={frontmatter.image} alt={frontmatter.title} class="w-full h-64 object-cover rounded-xl shadow-sm mb-8" loading="eager" />
        )}

        <slot />
      </article>

      <aside class="hidden lg:block h-full">
        
        <div class="sticky top-24">
          <TableOfContents headings={headings} />
        </div>

      </aside>

    </main>

    <Footer />
    <CodeCopyButton />
    <TableWrapper />
  </body>
</html>